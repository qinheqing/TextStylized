<!--index.wxml-->
<navigation-bar title="æ–‡æ¡ˆé£æ ¼åŒ–" back="{{false}}" color="black" background="#F2F2F7"></navigation-bar>
<scroll-view class="scrollarea" scroll-y type="simple">
  <view class="container">
    
    <!-- Tab åˆ‡æ¢å™¨ -->
    <view class="tab-container">
      <view class="tab-item {{activeTab === 'rewrite' ? 'active' : ''}}" bindtap="onTabChange" data-tab="rewrite">
        <text>è‡ªç”±æ”¹å†™</text>
      </view>
      <view class="tab-item {{activeTab === 'wizard' ? 'active' : ''}}" bindtap="onTabChange" data-tab="wizard">
        <text>çµæ„Ÿå‘å¯¼</text>
      </view>
    </view>

    <!-- æ¨¡å¼ä¸€ï¼šè‡ªç”±æ”¹å†™ -->
    <view class="mode-content {{activeTab === 'rewrite' ? 'show' : ''}}" wx:if="{{activeTab === 'rewrite'}}">
      <view class="section">
        <view class="section-title">
          <text class="title-text">åŸå§‹æ–‡æ¡ˆ</text>
          <text class="clear-btn" bindtap="onClearInput" wx:if="{{inputText}}">æ¸…ç©º</text>
        </view>
        <view class="card input-card">
          <textarea 
            class="input-area" 
            placeholder="è¾“å…¥ä½ æƒ³æ”¹å†™çš„æ–‡å­—..." 
            value="{{inputText}}"
            bindinput="onInput"
            maxlength="300"
            placeholder-style="color: #C7C7CC;"
          ></textarea>
          <view class="char-count">{{inputText.length}}/300</view>
        </view>
      </view>
    </view>

    <!-- æ¨¡å¼äºŒï¼šçµæ„Ÿå‘å¯¼ -->
    <view class="mode-content {{activeTab === 'wizard' ? 'show' : ''}}" wx:if="{{activeTab === 'wizard'}}">
      <view class="section">
        <view class="section-title">
          <text class="title-text">é€‰æ‹©åˆ›ä½œåœºæ™¯</text>
        </view>
        <view class="scenario-grid">
          <view 
            class="scenario-card" 
            wx:for="{{scenarios}}" 
            wx:key="id" 
            bindtap="onOpenWizard" 
            data-id="{{item.id}}"
          >
            <view class="scenario-icon-box">
              <text class="scenario-icon">{{item.icon}}</text>
            </view>
            <view class="scenario-info">
              <text class="scenario-name">{{item.name}}</text>
              <text class="scenario-desc">{{item.desc}}</text>
            </view>
            <view class="arrow-icon">â”</view>
          </view>
        </view>
      </view>
    </view>

    <!-- é£æ ¼é€‰æ‹©åŒº (ä»…åœ¨è‡ªç”±æ”¹å†™æ¨¡å¼ä¸‹æ˜¾ç¤º) -->
    <view class="section" wx:if="{{activeTab === 'rewrite'}}">
      <view class="section-title">
        <text class="title-text">æ”¹å†™é£æ ¼</text>
      </view>
      <view class="style-grid">
        <view 
          class="style-card {{selectedStyle === item.id ? 'active' : ''}}" 
          wx:for="{{styles}}" 
          wx:key="id"
          bindtap="onSelectStyle"
          data-id="{{item.id}}"
        >
          <text class="style-icon">{{item.icon}}</text>
          <view class="style-name">{{item.name}}</view>
          <view class="style-desc">{{item.desc}}</view>
          <view class="active-badge" wx:if="{{selectedStyle === item.id}}">
            <icon type="success_no_circle" size="10" color="#FFFFFF"></icon>
          </view>
        </view>
      </view>
    </view>

    <!-- ç”ŸæˆæŒ‰é’® (ä»…åœ¨è‡ªç”±æ”¹å†™æ¨¡å¼ä¸‹æ˜¾ç¤º) -->
    <button 
      wx:if="{{activeTab === 'rewrite'}}"
      class="generate-btn {{loading ? 'loading' : ''}}" 
      bindtap="onGenerate" 
      disabled="{{loading}}"
    >
      <view class="btn-content">
        <view class="spinner" wx:if="{{loading}}"></view>
        <text>{{loading ? 'æ­£åœ¨æ„æ€...' : 'ç¡®è®¤å¹¶å¼€å§‹æ”¹å†™'}}</text>
      </view>
    </button>

    <!-- ç»“æœå±•ç¤ºåŒº -->
    <view class="section">
      <view class="card result-card {{result || loading ? 'show' : ''}}" wx:if="{{result || loading}}">
        <view class="section-title">
          <text class="title-text">ç”Ÿæˆç»“æœ</text>
          <view class="result-actions" wx:if="{{result && !loading}}">
            <text class="action-btn" bindtap="onRegenerate">æ¢ä¸€æ‰¹</text>
            <text class="action-btn" bindtap="onCopyResult">å¤åˆ¶</text>
            <text class="action-btn primary" bindtap="onSaveResult">ä¿å­˜</text>
          </view>
        </view>
        <view class="result-content">
          <block wx:if="{{!loading}}">
            <text class="result-text" user-select>{{result}}</text>
          </block>
          <view class="skeleton" wx:else>
            <view class="skeleton-line"></view>
            <view class="skeleton-line"></view>
            <view class="skeleton-line short"></view>
          </view>
        </view>
      </view>
    </view>

    <view class="action-footer" wx:if="{{result && !loading}}">
      <button class="reset-btn" bindtap="onReset">é‡æ–°å¼€å§‹</button>
    </view>

    <view class="footer-tips">çµæ„Ÿè§¦æ‰‹å¯åŠ Â· å®éªŒå®¤å‡ºå“</view>
  </view>
</scroll-view>

<!-- åœºæ™¯å‘å¯¼å¼¹çª— -->
<view class="wizard-overlay {{showWizard ? 'show' : ''}}" bindtap="onCloseWizard">
  <view class="wizard-sheet" catchtap="true">
    <view class="wizard-header">
      <view class="scenario-icon-small">{{currentScenario.icon}}</view>
      <text class="wizard-title">{{currentScenario.name}}</text>
      <view class="close-icon" bindtap="onCloseWizard">âœ•</view>
    </view>
    
    <scroll-view scroll-y class="wizard-body">
      <!-- ç¬¬ä¸€æ­¥ï¼šä¿¡æ¯å¡«å†™ -->
      <view class="wizard-section">
        <view class="wizard-section-title">1. å®Œå–„ç»†èŠ‚</view>
        <view class="wizard-field" wx:for="{{currentScenario.fields}}" wx:key="key">
          <text class="field-label">{{item.label}}</text>
          <textarea 
            class="field-input" 
            placeholder="{{item.placeholder}}" 
            bindinput="onWizardInput" 
            data-key="{{item.key}}"
            value="{{wizardFormData[item.key]}}"
            fixed
            auto-height
          ></textarea>
        </view>
      </view>
      
      <!-- ç¬¬äºŒæ­¥ï¼šé£æ ¼é€‰æ‹© -->
      <view class="wizard-section">
        <view class="wizard-section-title">2. é€‰æ‹©é£æ ¼</view>
        
        <!-- å»ºè®®é£æ ¼ -->
        <view class="suggestion-tag-box">
          <text class="suggestion-label">ğŸ’¡ å»ºè®®é£æ ¼ï¼š</text>
          <view class="tag-list">
            <view 
              class="suggestion-tag {{selectedStyle === styleId ? 'active' : ''}}" 
              wx:for="{{currentScenario.suggestedStyles}}" 
              wx:for-item="styleId" 
              wx:key="*this"
              bindtap="onSelectStyle"
              data-id="{{styleId}}"
            >
              {{(styles[0].id === styleId ? styles[0].name : (styles[1].id === styleId ? styles[1].name : (styles[2].id === styleId ? styles[2].name : (styles[3].id === styleId ? styles[3].name : (styles[4].id === styleId ? styles[4].name : (styles[5].id === styleId ? styles[5].name : (styles[6].id === styleId ? styles[6].name : (styles[7].id === styleId ? styles[7].name : (styles[8].id === styleId ? styles[8].name : (styles[9].id === styleId ? styles[9].name : (styles[10].id === styleId ? styles[10].name : styles[11].name)))))))))))}}
            </view>
          </view>
        </view>

        <!-- æ‰€æœ‰é£æ ¼ç½‘æ ¼ -->
        <view class="style-grid mini">
          <view 
            class="style-card {{selectedStyle === item.id ? 'active' : ''}}" 
            wx:for="{{styles}}" 
            wx:key="id"
            bindtap="onSelectStyle"
            data-id="{{item.id}}"
          >
            <text class="style-icon">{{item.icon}}</text>
            <view class="style-name">{{item.name}}</view>
            <view class="active-badge" wx:if="{{selectedStyle === item.id}}">
              <icon type="success_no_circle" size="8" color="#FFFFFF"></icon>
            </view>
          </view>
        </view>
      </view>

      <view class="wizard-spacer"></view>
    </scroll-view>

    <view class="wizard-footer">
      <button class="wizard-gen-btn {{loading ? 'loading' : ''}}" bindtap="onGenerate" disabled="{{loading}}">
        <view class="btn-content">
          <view class="spinner" wx:if="{{loading}}"></view>
          <text>{{loading ? 'æ­£åœ¨æ„æ€...' : 'ç¡®è®¤å¹¶å¼€å§‹ç”Ÿæˆ'}}</text>
        </view>
      </button>
    </view>
  </view>
</view>
